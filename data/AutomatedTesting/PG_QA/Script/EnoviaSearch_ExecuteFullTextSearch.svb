'USEUNIT EnoviaSearch_PopulateSearchModel
'USEUNIT EnoviaSearchModels
'USEUNIT OR_Enovia
'USEUNIT LogLib
'USEUNIT WindowsUtility
'USEUNIT EnoviaUtils
'USEUNIT GlobalVars
'USEUNIT WebObjectLib
'USEUNIT EnoviaSearch_Utility
'USEUNIT EnoviaSearch_ValidateResults

'------------------------------------FullText Search-------------------------------------------------------------
'##################################################################################################################
'Function Name                : EnoviaSearch_StartFullTextSearch()
'Description                  : Performing the main search for Fulltext Search Type
'Arguments                    : NA
'Return Value                 : Nothing
'Author                       : Sumana Gottipati
'Creation Date                : 12-Jun-2017
'Special Conditions           : NA                                     
'Revision History             : Geetanjali - Updated the code to set it appropriately
'Revision Date                : 15-Jun-2017
'##################################################################################################################
Function EnoviaSearch_StartFullTextSearch(oModel)
  
  On Error Resume Next

  'Open the full text search window
  bPassed = true
  sErrorMsg = ""
  Call Enovia_FullTextSearch()  
  If Err.Number <> 0 Then
    bPassed = false
    sErrorMsg = Err.Description
  End If
  Call LogStepData("Open full text search window", bPassed, sErrorMsg, "")
  
  'Maximizes the full text search window
  If g_isBlocked = false Then
    Call MaximizeAllWindows()
    aqUtils.Delay 10000,"Waiting until the page is loaded." 
  End If
  
  'Perform search for only the search value
  bPassed = true
  sErrorMsg = ""
  Call EnoviaSearch_SelectAndRunFullTextSearch(oModel)
  If Err.Number <> 0 Then
    bPassed = false
    sErrorMsg = Err.Description
  End If
  Call LogStepData("Initial Full Text Search", bPassed, sErrorMsg, CombineSearchStrings(oModel.Common.SearchValue))
  
  'Handle the alert window if it pops up
  If g_isBlocked = false Then
    Call EnoviaSearch_AlertWindow("")
  End If
 
  'Validate the Main search results
  If g_isBlocked = false Then
    If CombineSearchStrings(oModel.Common.ResultsMain) <> "$" Then
      Call EnoviaSearch_ValidateFullTextSearch(oModel,"Main")
    End If
    
  If Err.Number <> 0 Then
      bPassed = false
      sErrorMsg = Err.Description
    End If    
  Else
    sErrorMsg = ""
    bPassed = true
  End If
  
  Call LogStepData("Validate Initial Full Text Search", bPassed, sErrorMsg, CombineSearchStrings(oModel.Common.ResultsMain))
    
  
  'Perform the refined Search
  If g_isBlocked = false Then
    If CombineSearchStrings(oModel.Common.ResultsRefined) <> "$" Then
      Call EnoviaFullText_ExecuteAll(oModel)
    End If
    
  If Err.Number <> 0 Then
      bPassed = false
      sErrorMsg = Err.Description
    End If    
  Else
    sErrorMsg = ""
    bPassed = true
  End If
  
  Call LogStepData("Refined Full Text Search", bPassed, sErrorMsg, CombineSearchStrings(oModel.Common.ResultsRefined))
  
  
  'Perform the refined validation
  If g_isBlocked = false Then
    If CombineSearchStrings(oModel.Common.ResultsRefined) <> "$" Then
      Call EnoviaSearch_ValidateFullTextSearch(oModel,"Refined") 
    End If
     
  If Err.Number <> 0 Then
      bPassed = false
      sErrorMsg = Err.Description
    End If    
  Else
    sErrorMsg = ""
    bPassed = true
  End If
  
  Call EnoviaSearch_CloseSearchWindows()
  
  Call LogStepData("Validate Refined Full Text Search", bPassed, sErrorMsg, oModel.Common.ResultsRefined)
  
End Function

'##################################################################################################################
'Function Name                : EnoviaSearch_SelectAndRunFullTextSearch()
'Description                  : Performing the main search for Fulltext Search Type
'Arguments                    : NA
'Return Value                 : Nothing
'Author                       : Geetanjali
'Creation Date                : 2-Jun-2017
'Special Conditions           : NA                                     
'Revision History             : 
'Revision Date                : 
'##################################################################################################################

Function EnoviaSearch_SelectAndRunFullTextSearch(oModel)

  If (EnoviaSearch_ValCheck(oModel.Common.SearchValue) = True) Then 
    Set objSearchVal = objGetObject(OR_EnoviaSearchFullText_SearchEdt,g_SearchPageURL,1500)
    If IsArray(oModel.Common.SearchValue) = True Then
      sSearch = oModel.Common.SearchValue
      For i = 0 to UBound(sSearch)
        objSearchVal.Keys(sSearch(i)&"|")
      Next
    Else
    objSearchVal.SetText(oModel.Common.SearchValue)
    End If

  Set objFullTextSearch = objGetObject(OR_EnoviaSearchFullText_Search,g_SearchPageURL,1500)
  objFullTextSearch.Click()
  Set objFullTextSearch = Nothing
  
  Else
    Call Err.Raise (60001,"EnoviaNamed_ExecuteFullTextSearch","Missing search value in spreadsheet.")
  End If
  
End Function 

'##################################################################################################################
'Function Name                : EnoviaFullText_ExecuteAll()
'Description                  : Performing Operations on Fulltext Search Type
'Arguments                    : NA
'Return Value                 : Nothing
'Author                       : Sumana Gottipati
'Creation Date                : 23 & 24 - May -2017
'Special Conditions           : NA                                     
'Revision History             : Geetanjali - Added validations for Multi Select, Array Check, Null Check, 
'                               Dynamic Check Box Check
'Revision Date                : 3-Jun-2017
'##################################################################################################################
  
Function EnoviaFullText_ExecuteAll(oModel)

  Dim bFlag
  bFlag = False
  If (EnoviaSearch_ValCheck(oModel.Common.SearchValue) = True) Then
   If oModel.Common.LimitResults <> "" Then
      Set objPageSize = objGetObject(OR_EnoviaSearchFullText_PagesizeEdt,g_SearchPageURL,1500)      
      If Not (objPageSize is Nothing) Then
        objPageSize.SetText(oModel.Common.LimitResults)
        Set objPageSize = Nothing
        bFlag = True
      End If
   End If

'-------------------------------------------------------------------------------------------------------------
     
  If (EnoviaSearch_ValCheck(oModel.Common.sType) = True) Then          
    Set objType = objGetObject(OR_EnoviaSearchFullText_TypePnl,g_SearchPageURL,1500)
    If Not (objType is Nothing) Then
      objType.Click()
      Set objType = Nothing
    End If
     
    Set objTypeInput = objGetObject(OR_EnoviaSearchFullText_TypeDrp,g_SearchPageURL,3000)
    
    If Not (objTypeInput is Nothing) Then     
      Call EnoviaSearch_SelectList(objTypeInput,oModel.Common.sType)    
      Set objTypeInput = Nothing      
      Set objTypeSubmit = objGetObject(OR_EnoviaSearchFullText_TypeBtn,g_SearchPageURL,1500)
      objTypeSubmit.ClickButton()
      Set objTypeSubmit = Nothing
    Else 
      Call EnoviaSearch_DynText(objDynText,oModel.Common.sType)
    End If
    bFlag = True
  End If

'-------------------------------------------------------------------------------------------------------------  
  
  If (EnoviaSearch_ValCheck(oModel.Common.State) = True) Then
    Set objState = objGetObject(OR_EnoviaSearchFullText_StatePnl,g_SearchPageURL,1500)
    If Not (objState is Nothing) Then
      objState.Click()
      Set objState = Nothing
    End If
    
    Set objStateInput = objGetObject(OR_EnoviaSearchFullText_StateDrp,g_SearchPageURL,3000)
    
    If Not (objStateInput is Nothing) Then    
      Call EnoviaSearch_SelectList(objStateInput,oModel.Common.State)    
      Set objStateInput = Nothing    
      Set objsubmitState = objGetObject(OR_EnoviaSearchFullText_StateBtn,g_SearchPageURL,1500)
      objsubmitState.ClickButton()
      Set objsubmitState = Nothing
    Else
      Call EnoviaSearch_DynText(objDynText,oModel.Common.State)
    End If
    bFlag = True   
  End If
  
'-------------------------------------------------------------------------------------------------------------
        
  If (EnoviaSearch_ValCheck(oModel.SecCatClassification) = True) Then    
    Set objSecurity = objGetObject(OR_EnoviaSearchFullText_SecurityPnl,g_SearchPageURL,1500)
    If Not (objSecurity is Nothing) Then
      objSecurity.Click()
      Set objSecurity = Nothing
    End If
    
    Set objInputSecurity = objGetObject(OR_EnoviaSearchFullText_SecurityDrp,g_SearchPageURL,3000)
    
    If Not (objInputSecurity is Nothing) Then
      Call EnoviaSearch_SelectList(objInputSecurity,oModel.SecCatClassification)    
      Set objInputSecurity = Nothing    
      Set objsubmitSecurity = objGetObject(OR_EnoviaSearchFullText_SecurityBtn,g_SearchPageURL,1500)
      objsubmitSecurity.ClickButton()
      Set objsubmitSecurity = Nothing
    Else
      Call EnoviaSearch_DynText(objDynText,oModel.SecCatClassification)
    End If
    bFlag = True
  End If
  
'-------------------------------------------------------------------------------------------------------------
  
  If (EnoviaSearch_ValCheck(oModel.CSSBusinessCat) = True) Then 
    Set objBusiness = objGetObject(OR_EnoviaSearchFullText_BusinessPnl,g_SearchPageURL,1500)
    If Not (objBusiness is Nothing) Then
      objBusiness.Click()
      Set objBusiness = Nothing
    End If  
    
    Set objBusinessInput = objGetObject(OR_EnoviaSearchFullText_BusinessDrp,g_SearchPageURL,3000)
    
    If Not (objBusinessInput is Nothing) Then
      Call EnoviaSearch_SelectList(objBusinessInput,oModel.CSSBusinessCat)    
      Set objBusinessInput = Nothing      
      Set objsubmitBusiness = objGetObject(OR_EnoviaSearchFullText_BusinessBtn,g_SearchPageURL,1500)
      objsubmitBusiness.ClickButton()
      Set objsubmitBusiness = Nothing
    Else
      Call EnoviaSearch_DynText(objDynText,oModel.CSSBusinessCat)
    End If
    bFlag = True
  End If
  
'-------------------------------------------------------------------------------------------------------------
  
  If (EnoviaSearch_ValCheck(oModel.Plant) = True) Then 
    Set objPlant = objGetObject(OR_EnoviaSearchFullText_PlantPnl,g_SearchPageURL,1500)
    If Not (objPlant is Nothing) Then
      objPlant.Click()
      Set objPlant = Nothing
    End If
    
    Set objPlantInput = objGetObject(OR_EnoviaSearchFullText_PlantDrp,g_SearchPageURL,3000)
    
    If Not (objPlantInput is Nothing) Then    
      Call EnoviaSearch_SelectList(objPlantInput,oModel.Plant)    
      Set objPlantInput = Nothing    
      Set objsubmitPlant = objGetObject(OR_EnoviaSearchFullText_PlantBtn,g_SearchPageURL,1500)
      objsubmitPlant.ClickButton()
      Set objsubmitPlant = Nothing
    Else
      Call EnoviaSearch_DynText(objDynText,oModel.Plant)
    End If
    bFlag = True
  End If
  
'-------------------------------------------------------------------------------------------------------------
  
  If (EnoviaSearch_ValCheck(oModel.OwningStandardsOffice) = True) Then 
    Set objStandards = objGetObject(OR_EnoviaSearchFullText_StandardsPnl,g_SearchPageURL,1500)
    If Not (objStandards is Nothing) Then
      objStandards.Click()
      Set objStandards = Nothing
    End If
    
    Set objStandardsInput = objGetObject(OR_EnoviaSearchFullText_StandardsDrp,g_SearchPageURL,3000)
        
    If Not (objStandardsInput is Nothing) Then    
      Call EnoviaSearch_SelectList(objStandardsInput,oModel.OwningStandardsOffice)    
      Set objStandardsInput = Nothing    
      Set objsubmitStandards = objGetObject(OR_EnoviaSearchFullText_StandardsBtn,g_SearchPageURL,1500)
      objsubmitStandards.ClickButton()
      Set objsubmitStandards = Nothing    
    Else
      Call EnoviaSearch_DynText(objDynText,oModel.OwningStandardsOffice)
    End If
    bFlag = True
  End If
  
'-------------------------------------------------------------------------------------------------------------

  If (EnoviaSearch_ValCheck(oModel.Revision.Revision) = True) Then
    Set objRevision = objGetObject(OR_EnoviaSearchFullText_RevisionPnl,g_SearchPageURL,1500)
    If Not (objRevision is Nothing) Then
      objRevision.Click()
      objRevision.ScrollIntoView()
      Set objRevision = Nothing
    End If
    Call EnoviaSearch_DynText(objRevisionInput,oModel.Revision.Revision)
    End If
    bFlag = True
  End If

'-------------------------------------------------------------------------------------------------------------
  If bFlag = True Then
    Set objFullTextSearch = objGetObject(OR_EnoviaSearchFullText_Search,g_SearchPageURL,1500)
    If Not (objFullTextSearch is Nothing) Then
      objFullTextSearch.Click()
      Set objFullTextSearch = Nothing
    End If
  End If
    
End Function 
