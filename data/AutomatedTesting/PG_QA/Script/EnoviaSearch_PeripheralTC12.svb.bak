'USEUNIT GlobalVars	
'USEUNIT LogLib	
'USEUNIT OR_Enovia	
'USEUNIT WindowsUtility	
'USEUNIT EnoviaUtils	
'USEUNIT WebObjectLib	
'USEUNIT EnoviaSearch_PopulateSearchModel
                                                                                     
Function EnoviaSearch_PeripheralTC12_Steps()	
	                                                                                                                              
	  Call LogStep("EnoviaSearch_PeripheralTC12_Step1", "A dropdown with various commands(Like-Named Search, My Favourite Searches, Full Text Search..etc) should appear","")
	  Call LogStep("EnoviaSearch_PeripheralTC12_Step2", "A new window with Search Refinement Pane and Search Results Pane should pop up","")
	  Call LogStep("EnoviaSearch_PeripheralTC12_Step3", "The Search Results Pane should refresh and all the objects which contain the Name(s)/Phrase(s) that was typed will be displayed. Ex:  All the Objects which contain the Phrase Test in their Specification/Attributes/Docs should be displayed.","")
	  Call LogStep("EnoviaSearch_PeripheralTC12_Step4", "An Excel file containing a list of all your search results should be exported and Downloaded to your Local System","")
	  Call LogStep("EnoviaSearch_PeripheralTC12_Step5", "A new Sort By window should pop up","")
	  Call LogStep("EnoviaSearch_PeripheralTC12_Step6", "Selected value should be displayed on the textbox beside 1st","")
	  Call LogStep("EnoviaSearch_PeripheralTC12_Step7", "Selected value should be displayed on the textbox beside 2nd","")
	  Call LogStep("EnoviaSearch_PeripheralTC12_Step8", "Selected value should be displayed on the textbox beside 3rd","")
	  Call LogStep("EnoviaSearch_PeripheralTC12_Step9", "The Radio buttons are selected","")
    Call LogStep("EnoviaSearch_PeripheralTC12_Step10", "The Search Results should be sorted based on the Priority of 1st 2nd 3rd","")
                                                                                 
	  Call LogTestCase("Exporting/Sorting your Search Results", "TC-12_Full Text Search_Toolbar Export/Sort","47704")
	                                                                 
End Function	
                                                                     
'##################################################################################################################
'Function Name                : EnoviaSearch_PeripheralTC12_Step1
'Description                  : Drop down of various commands appears
'Arguments                    : NA
'Return Value                 : NA
'Author                       : Shireesha Monduti
'Creation Date                : 9-6-2017
'Special Conditions           : NA                                     
'Revision History             : NA
'Revision Date                : NA
'##################################################################################################################
	                                                                        
Function EnoviaSearch_PeripheralTC12_Step1()
                                        	
    'Create object for delete saved name                                                               
    Set objDeleteSaved = objGetObject(OR_EnoviaSearch_TC19_DeleteSavedName,"","")
    objDeleteSaved.Click()
    Set objDeleteSaved = nothing
                                                                                                 
    'Create object for FullSearch Text
    Set objFullSearchText = objGetObject(OR_EnoviaSearch_TC13_FullSearchText_Label,"",4000)
    If objFullSearchText.VisibleOnScreen = False Then
      Set objEnoviaSearchProductSpec = objGetObject(OR_EnoviaSearchProductSpec_SearchDrp,"","")
      objEnoviaSearchProductSpec.Click()
      If objFullSearchText.VisibleOnScreen = False Then
        Call Err.raise (65084,"EnoviaSearch_PeripheralTC8_Step1","A dropdown with various commands shown")
      End If
      Set objEnoviaSearchProductSpec = nothing 
    End If
    Set objFullSearchText = nothing
                                                
End Function	
	                                                            
'##################################################################################################################
'Function Name                : EnoviaSearch_PeripheralTC12_Step2
'Description                  : Full search text page opens
'Arguments                    : NA
'Return Value                 : NA
'Author                       : Shireesha Monduti
'Creation Date                : 9-6-2017
'Special Conditions           : NA                                     
'Revision History             : NA
'Revision Date                : NA
'##################################################################################################################
		
Function EnoviaSearch_PeripheralTC12_Step2()	
                                   
    'Create object for full Text Search Link                                                                         
    Set objFullSearchText = objGetObject(OR_EnoviaSearch_TC13_FullSearchText_Label,"","")
    objFullSearchText.Click()
    Set objFullSearchText = nothing
                                       
    'Create object for Name text field
    Set objNameEdit = objGetObject(OR_EnoviaSearchFullText_SearchEdt,g_SearchPageURL,4000)
    If objNameEdit.Exists = False Then
      Call Err.raise (65085,"EnoviaSearch_PeripheralTC8_Step2","A dropdown with various commands shown")
    End If
    Set objNameEdit = nothing
                                    
End Function	
	                             
'##################################################################################################################
'Function Name                : EnoviaSearch_PeripheralTC12_Step3
'Description                  : search a record
'Arguments                    : NA
'Return Value                 : NA
'Author                       : Shireesha Monduti
'Creation Date                : 9-6-2017
'Special Conditions           : NA                                     
'Revision History             : NA
'Revision Date                : NA
'##################################################################################################################
			
Function EnoviaSearch_PeripheralTC12_Step3()	
    
    'Create object for search Edit textbox                                                     
    Set objNameEdit = objGetObject(OR_EnoviaSearchFullText_SearchEdt,g_SearchPageURL,4000)
    SearchSaveName = EnoviaSearch_ReadTestCasesData("TC-12_Full Text Search_Toolbar Export/Sort","Phrase")
    objNameEdit.SetText(SearchSaveName)
    Set objNameEdit = nothing
                                                                                                             
    'Create object for search refresh command
    Set objSearchRefreshCmd = objGetObject(OR_EnoviaSearch_SSearchRefreshCmd,g_SearchPageURL,"")
    objSearchRefreshCmd.Click()
    Set objSearchRefreshCmd = nothing
    	
End Function	
	                                             
'##################################################################################################################
'Function Name                : EnoviaSearch_PeripheralTC12_Step4
'Description                  : Check the data is exported correctly or not
'Arguments                    : NA
'Return Value                 : NA
'Author                       : Shireesha Monduti
'Creation Date                : 9-6-2017
'Special Conditions           : NA                                     
'Revision History             : NA
'Revision Date                : NA
'##################################################################################################################
		
Function EnoviaSearch_PeripheralTC12_Step4()	
    
    Dim rowCountName                                            
    'Create object to get the rowcount of records displayed
    Set objLimitRowCount=objGetObject(OR_EnoviaSearch_TC17_Rows,g_SearchPageURL,4000)
    rowCount = objLimitRowCount.rowCount
    ApplicationRowCount=rowCount-1  'Reduce count by 1 as the row count property includes 0th row
    Set objLimitRowCount=nothing
                                            
    'Create object for toolimage
    Set objToolImage = objGetObject(OR_EnoviaSearch_TC7_ToolImage,g_SearchPageURL,4000)
    objToolImage.Click()
    Set objToolImage = nothing
    
    'Create object for export command
    Set objExportCommand = objGetObject(OR_EnoviaSearch_TC13_ExportCommand,g_SearchPageURL,4000)
    objExportCommand.Click()
    Set objExportCommand = nothing
    
    'Delay needed so that popup appears
    aqutils.Delay 10000,"Export the contents to Page"                                                                                

    Set s1=Sys.Browser("iexplore").Browserwindow(0)  
    arrchild = s1.findAll("ObjectIdentifier","Save",5)
    If ubound(arrchild)  < 0 Then
      Set s1=Sys.Browser("iexplore").Browserwindow(1) 
    End If
                            
    set frame=s1.findChild("WndClass","Frame Notification Bar",5) 
     Set objdownbtn=frame.findChild("Name","UIAObject(1)",5) 
     IF objdownbtn.Exists then                            
        objdownbtn.Click                                                            
     End IF
     Sys.Keys "[Down][Enter]"
     Set objwnd = Sys.Process(g_strBrowserType).window("*","Save As")
     Set objEdit = objwnd.FindChild("WndClass","Edit",5)
     
    'SendKeys to press backspace
    Set oWshell = CreateObject("WScript.Shell")  
      'Delay need to be added befor pressing the backspace
      aqUtils.Delay 4000," Delay need to be added befor pressing the backspace."    
      oWshell.SendKeys "{BACKSPACE}" 
      Set oWshell = Nothing
    objEdit.SetText(ExcelPath)     
    Set objEdit = nothing
                                                                                 
    'objEdit.Keys foldinfo&filename                                                                                            
    Set objsavebtn = objwnd.FindChild("WndCaption","&Save")                         
    objsavebtn.Click  
    Set objsavebtn= nothing
    Set s1=nothing
    Set frame=nothing
    Set objwnd=nothing
    
    'Code to get the Excel row count
    Set objexl  = Createobject("Excel.application")
    objexl.visible = False
    set objwkb = objexl.workbooks.open(ExcelPath&".csv")
    set objsht = objwkb.sheets(1)
    ExcelRowCount=objsht.usedrange.rows.count
    ActualExcelRowCount = ExcelRowCount-3 
    ExcelRowCount= ActualExcelRowCount
    objwkb.Close
    objexl.Quit
    If ApplicationRowCount <> ExcelRowCount Then
       Call Err.raise (65086,"EnoviaSearch_PeripheralTC12_Step6","Correct record doesnot appear")
    End IF   
    Set objexl = nothing
    Set objsht= nothing
                                                                   
End Function	
	                                                                  
'##################################################################################################################
'Function Name                : EnoviaSearch_PeripheralTC12_Step5
'Description                  : open multi column page
'Arguments                    : NA
'Return Value                 : NA
'Author                       : Shireesha Monduti
'Creation Date                : 9-6-2017
'Special Conditions           : NA                                     
'Revision History             : NA
'Revision Date                : NA
'##################################################################################################################
			                                                            
Function EnoviaSearch_PeripheralTC12_Step5()	
                                                       
    'create object for saving the export
    Set objToolImage = objGetObject(OR_EnoviaSearch_TC7_ToolImage,g_SearchPageURL,4000)
    objToolImage.Click()
    Set objToolImage = nothing
                                                            
    'create object for multicolumn
    Set objMultiColumn = objGetObject(OR_EnoviaSearch_TC13_MultiColumn,g_SearchPageURL,4000)
    objMultiColumn.Click()
    Set objMultiColumn = nothing
                                                                 	
End Function	
	                                                    
'##################################################################################################################
'Function Name                : EnoviaSearch_PeripheralTC12_Step6
'Description                  : Select values under the 1st Dropdown
'Arguments                    : NA
'Return Value                 : NA
'Author                       : Shireesha Monduti
'Creation Date                : 9-6-2017
'Special Conditions           : NA                                     
'Revision History             : NA
'Revision Date                : NA
'##################################################################################################################
			
Function EnoviaSearch_PeripheralTC12_Step6()	
                                                   
    'create object for multicolumn
    Set objMultiFirst = objGetObject(OR_EnoviaSearch_TC13_MultiFirstColumn,g_MultiColumnSortDialog_URL,4000)
    objMultiFirst.ClickItem("Name")
    Set objMultiFirst = nothing
                         
End Function	
	                             
'##################################################################################################################
'Function Name                : EnoviaSearch_PeripheralTC12_Step7
'Description                  : Select values under the 2nd Dropdown
'Arguments                    : NA
'Return Value                 : NA
'Author                       : Shireesha Monduti
'Creation Date                : 9-6-2017
'Special Conditions           : NA                                     
'Revision History             : NA
'Revision Date                : NA
'##################################################################################################################
			
Function EnoviaSearch_PeripheralTC12_Step7()	
                                                    
    'create object for multicolumn
    Set objMultiSecond = objGetObject(OR_EnoviaSearch_TC13_MultiSecondColumn,g_MultiColumnSortDialog_URL,"")
    objMultiSecond.ClickItem("Type")
    Set objMultiSecond = nothing
                        
End Function	
	                                      
'##################################################################################################################
'Function Name                : EnoviaSearch_PeripheralTC12_Step8
'Description                  : Select values under the 1st Dropdown
'Arguments                    : NA
'Return Value                 : NA
'Author                       : Shireesha Monduti
'Creation Date                : 9-6-2017
'Special Conditions           : NA                                     
'Revision History             : NA
'Revision Date                : NA
'##################################################################################################################
				
Function EnoviaSearch_PeripheralTC12_Step8()	
                                           
    'create object for multicolumn
    Set objMultiThird = objGetObject(OR_EnoviaSearch_TC13_MultiThirdColumn,g_MultiColumnSortDialog_URL,"")
    objMultiThird.ClickItem("State")
    Set objMultiThird = nothing
     
End Function	
                                          
'##################################################################################################################
'Function Name                : EnoviaSearch_PeripheralTC12_Step9
'Description                  : click on done
'Arguments                    : NA
'Return Value                 : NA
'Author                       : Shireesha Monduti
'Creation Date                : 9-6-2017
'Special Conditions           : NA                                     
'Revision History             : NA
'Revision Date                : NA
'##################################################################################################################
	                                              			
Function EnoviaSearch_PeripheralTC12_Step9()	
                                                        
    'create object for done button
    Set objDoneButton = objGetObject(OR_EnoviaSearch_TC19_DoneButton,g_MultiColumnSortDialog_URL,"")
    objDoneButton.Click()
    Set objDoneButton = nothing
                                                                                                 
End Function	
                                                
'##################################################################################################################
'Function Name                : EnoviaSearch_PeripheralTC12_Step8
'Description                  : check the sorting order
'Arguments                    : NA
'Return Value                 : NA
'Author                       : Shireesha Monduti
'Creation Date                : 9-6-2017
'Special Conditions           : NA                                     
'Revision History             : NA
'Revision Date                : NA
'##################################################################################################################
		                                                 		                                                
Function EnoviaSearch_PeripheralTC12_Step10()
                                            	
    'Create the Excel Object                                                                                             
    Set objExcel = createobject("excel.application")
    Set oWorkbook1= objExcel.Workbooks.Open(ExcelPath&".csv")                                                                     
    Set  omysheet1=oWorkbook1.Worksheets(1)
    iRowCnt = omysheet1.UsedRange.Rows.Count
    for i = 1 to iRowCnt
        If Ucase(omysheet1.Cells(i,1).Value) = "LEVEL" Then
          iColHeadingRow = i
          Exit For
        End If
    Next
    iColNo_Name = fnGetColumnNumber(omysheet1,"Name",iColHeadingRow)
    iColNo_State = fnGetColumnNumber(omysheet1,"State",iColHeadingRow)
    iColNo_Type = fnGetColumnNumber(omysheet1,"Type",iColHeadingRow)
    
    'Code to check the sorting order                                                                              
    blnSort = True
    For i = iColHeadingRow+1 to iRowCnt-1
        For j = i+1 to iRowCnt
        
          If strComp(cStr(omysheet1.Cells(i,iColNo_Name).Value),cStr(omysheet1.Cells(j,iColNo_Name).Value)) = -1 Then
                                                                                          
          ElseIf strComp(cStr(omysheet1.Cells(i,iColNo_Name).Value),cStr(omysheet1.Cells(j,iColNo_Name).Value)) = 0 Then
                                                                        
                If strComp(cStr(omysheet1.Cells(i,iColNo_Type).Value),cStr(omysheet1.Cells(j,iColNo_Type).Value)) = -1 Then
                                                                                          
                ElseIf strComp(cStr(omysheet1.Cells(i,iColNo_Type).Value),cStr(omysheet1.Cells(j,iColNo_Type).Value)) = 0 Then
                    If strComp(cStr(omysheet1.Cells(i,iColNo_State).Value),cStr(omysheet1.Cells(j,iColNo_State).Value)) = -1 Then
                                                                                         
                    ElseIf strComp(cStr(omysheet1.Cells(i,iColNo_State).Value),cStr(omysheet1.Cells(j,iColNo_State).Value)) = 0 Then
                                                                                            
                    Else
                        blnSort = False   
                    End If
                Else                                                         
                    blnSort = False
                End If  
          Else                                                                     
             blnSort = False                                             
          End If                                          
        Next                                                            
    Next                                                  
    If blnSort = False   Then                        
        Call Err.raise (65087,"EnoviaSearch_PeripheralTC8_Step12","Correct order does not appear")
    End If                                                       
    Set objexl = nothing
    Set omysheet1= nothing
                                 
End Function	
