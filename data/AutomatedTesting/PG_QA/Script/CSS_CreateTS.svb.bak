'USEUNIT ExcelLib
'USEUNIT GlobalVars
'USEUNIT WebKeywords
'USEUNIT WebObjectLib
'USEUNIT WindowsUtility
'USEUNIT CSSUtils
'USEUNIT StringLib
'USEUNIT TR_EnoviaUtils
'USEUNIT CSS_OBJClass
'USEUNIT CSS_SearchItem
'USEUNIT OR_CSS
'USEUNIT CSS_Upload

'##################################################################################################################
'Function Name                : CSSCreate_ChooseStandardType
'Description                  : choose standard type and structured type
'Arguments                    : strType:standard type bIsStructured:structured type
'Return Value                 : NA
'Author                       : Xiaoji Sun 
'Creation Date                : 30 -Aug- 2017
'Special Conditions           : NA                                       
'Revision History             : NA
'Revision Date                : 28 -sep- 2017
'Comments                     :modify by lene  
'##################################################################################################################
Function CSSCreate_ChooseStandardType(strType,bIsStructured)  'as Xiaoji
  On Error Resume Next

  ' Fetch Application Credentials
  Dim objTypeList
  Dim objAction
  Dim objCreate
  'Get Type list then select type
  Set objTypeList = objGetObject(OR_CSSCreate_TypeSelect,"",30000) 
  objTypeList.SelectItem(strType)
  
  'Choose structured or not 
  If bIsStructured = false Then
    Call Click(OR_CSSCreate_StructuredCheckBox,"","")
  End If
  'Clcik Action>>Create
  Call Click(OR_CSSCreate_TypeSelectActionBtn,"","")
  Call Click(OR_CSSCreate_TypeSelectActionCreateBtn,"","")
  
  If Err.Number = 0 Then
    CSSCreate_ChooseStandardType = True
  Else
    CSSCreate_ChooseStandardType  = False
  End If

  set objTypeList = nothing

End Function

'Function ChooseStandardType(str_type)  'as Xiaoji
'  On Error Resume Next
'
'  ' Fetch Application Credentials
'  Dim arrGetObj,objOriginator,objTechStandLink,objCreateNew,objTypeList,objAction,objCreate,strType
'  
'  str_Type = str_type&"*"
'
'  'Set objUserID = objGetObject(OR_EnoviaLogin_UserNameEdt,"","")
' 
'  'Get Originator 
'  arrGetObj = arrGetObjInfoFromXL("CSS_MainPage","Originator")
'  Set objOriginator = objGetObject(arrGetObj,c_CSSMainPage_URL,30000)
'  objOriginator.Click
'  'Get Technical Standards link
'  arrGetObj = arrGetObjInfoFromXL("CSS_MainPage","TechnicalStandards")
'  Set objTechStandLink = objGetObject(arrGetObj,c_CSSMainPage_URL,30000) 
'  objTechStandLink.Click
'  
'  'Get Create New Standards link
'  arrGetObj = arrGetObjInfoFromXL("CSS_MainPage","CreateNewStandard")
'  Set objCreateNew = objGetObject(arrGetObj,c_CSSTSD_URL,30000)
'  objCreateNew.Click
'  
'  'Get Type list
'  arrGetObj = arrGetObjInfoFromXL("CSS_MainPage","TypeList")
'  Set objTypeList = objGetObject(arrGetObj,c_CSSTSHome_URL,30000) 
'  objTypeList.SelectItem(str_Type)
'  
'  'Get Action
'  arrGetObj = arrGetObjInfoFromXL("CSS_MainPage","Action")
'  Set objAction = objGetObject(arrGetObj,c_CSSTSHome_URL,30000) 
'  objAction.Click
'  
'  arrGetObj = arrGetObjInfoFromXL("CSS_MainPage","CreateLink")
'  Set objCreate = objGetObject(arrGetObj,c_CSSTSHome_URL,30000) 
'  objCreate.Click
'  
'  If Err.Number = 0 Then
'    ChooseStandardType = True
'  Else
'    ChooseStandardType  = False
'  End If
'
'  Set objTechStandLink = nothing
'  Set objCreateNew = nothing
'  set objTypeList = nothing
'
'End Function

'##################################################################################################################
'Function Name                : Input General
'Description                  : Input general information to create CSS
'Arguments                    : str_Data:name of new data in Case
'Return Value                 : NA
'Author                       : Xiaoji Sun
'Creation Date                : 30 -Aug- 2017
'Special Conditions           : NA                                       
'Revision History             : NA
'Revision Date                : NA
'##################################################################################################################
Function InputGeneral(str_Data, strSheet)
    Dim strDesc, strSAPDesc, strMaster, strReason, strMaterial, strOwnOrg, strSegment,strIsFormula, strType
    'Dim arrGetObj, objDesc,objSAPDesc,objMater,objReason,objMaterial
    'Get Attribute value for input from excel
    strDesc = Excel_SearchAttributeInputValue(g_strInputDataFilePath, strSheet, "Description", str_Data)
    strSAPDesc = Excel_SearchAttributeInputValue(g_strInputDataFilePath, strSheet, "SAPDescription", str_Data)
    strMaster = Excel_SearchAttributeInputValue(g_strInputDataFilePath, strSheet, "MasterGCAS", str_Data)
    strReason = Excel_SearchAttributeInputValue(g_strInputDataFilePath, strSheet, "ReasonForChange", str_Data)
    strMaterial = Excel_SearchAttributeInputValue(g_strInputDataFilePath, strSheet, "MaterialGroup", str_Data)
    strIsFormula = Excel_SearchAttributeInputValue(g_strInputDataFilePath, strSheet, "IsFormula", str_Data)
    strType = Excel_SearchAttributeInputValue(g_strInputDataFilePath, strSheet, "Type", str_Data)
    GeneralDesc.TextContent=strDesc
    GeneralSAPDesc.SetText(strSAPDesc)    
    GeneralReason.TextContent=strReason    
        
    If strMaster<>"" Then   
    GeneralMaster.SetText(strMaster)       
    End If
    
    If strIsFormula="Yes" Then
    IsFormula.Click  
    End If  
    Call SelectMaterialGroup(strMaterial,strType)
    
End Function 

'##################################################################################################################
'Function Name                : Input Ownership
'Description                  : Input ownership information to create CSS
'Arguments                    : str_Data:name of new data in Case
'Return Value                 : NA
'Author                       : Xiaoji Sun
'Creation Date                : 30 -Aug- 2017
'Special Conditions           : NA                                       
'Revision History             : NA
'Revision Date                : NA
'Comments                     :modify by lene 28,Sep,2017
'##################################################################################################################
Function InputOwnership(StrPDT,strSetName)
    Dim strOwnOrg
    Dim strSegment
    Dim strDesc
    Dim strSAPDesc
    Dim strDocument
     strInputDataFilePath=g_strInputDataFilePath&strSetName&"_DSM.xlsx"    
'    strOwnOrg = Excel_SearchAttributeInputValue(strInputDataFilePath, "CSSPDT", "OwningOrganization", strPDT)
'    strSegment = Excel_SearchAttributeInputValue(strInputDataFilePath, "CSSPDT", "Segment", strPDT)
'    strDesc = Excel_SearchAttributeInputValue(strInputDataFilePath, "CSSPDT", "Description", strPDT)
'    strSAPDesc = Excel_SearchAttributeInputValue(strInputDataFilePath, "CSSPDT", "SAP Description", strPDT)
   strDocument = Excel_SearchAttributeInputValue(strInputDataFilePath, "CSSPDT", "Technical standards Document", strPDT)
   ' Call CSSCreate_SetDes(strDesc)
   ' Call CSSCreate_SetSAPDes(strSAPDesc)
   ' Call CSSCreate_SetOrg(strOwnOrg)
    'Call CSSCreate_SetSeg(strSegment)
    Call CSS_FilUpload(ProjectSuite.Path&"Resources\UploadFile\"&strDocument)
   
END Function
'Function InputOwnership(Str_Data, strSheet)
'    Dim strOwnOrg, strSegment, objNav, strType
'    'Dim arrGetObj, objDesc,objSAPDesc,objMater,objReason,objMaterial
'    'Get Attribute value for input from excel
'    strOwnOrg = Excel_SearchAttributeInputValue(g_strInputDataFilePath, strSheet, "OwningOrganization", str_Data)
'    strSegment = Excel_SearchAttributeInputValue(g_strInputDataFilePath, strSheet, "Segment", str_Data)
'    strType = Excel_SearchAttributeInputValue(g_strInputDataFilePath, strSheet, "Type", str_Data)
'    strIsFormula = Excel_SearchAttributeInputValue(g_strInputDataFilePath, strSheet, "IsFormula", str_Data)
'    Set objNav = NavToOwnership(strType)
'    objNav.Click
'    AqUtils.Delay(3000)
'    SelectOrgnization(strOwnOrg)
'    AqUtils.Delay(2000)
'    Call SelectSegment(strSegment,strType,strIsFormula)  
'END Function

'##################################################################################################################
'Function Name                : Get GCAS Code
'Description                  : Get GCAS Code of new create Data
'Arguments                    : NA
'Return Value                 : NA
'Author                       : Xiaoji Sun
'Creation Date                : 31 -Aug- 2017
'Special Conditions           : NA                                       
'Revision History             : NA
'Revision Date                : NA
'##################################################################################################################
'*********modify by lene 27,09,2017********'
Function GetGCASCode(str_FullType)
Dim strGCAS
Set objGcasCode=objGetObject(OR_CSSPDT_CodeName,"",30000)
strGCAS = GetValue(objGcasCode, "contentText")
strGCAS = Replace(strGCAS, str_FullType, "")
strGCAS = Replace(strGCAS, "(DOC)", "")
GetGCASCode = Trim(strGCAS)
END Function

'Function GetGCASCode()
'Dim strGCAS
'strGCAS = GetValue(GCASCode, "contentText")
'GetGCASCode = strGCAS
'END Function


Function CopyToRevise(strData,strSheetName)
CreateActionBtn.Click
CopyToReviseBtn.Click
ReviseConfirmOK.Click
AqUtils.Delay(9000)
GeneralReason.TextContent = "New"
strGCAS = GetGCASCode()
Call Excel_InsertValueIntoSpecifiedCell(g_strOutputDataFilePath, strSheetName, strData, "Value", strGCAS)
CreateActionBtn.Click
CreateSaveBtn.Click
End Function


'##################################################################################################################
'Function Name                : GetTSObjId
'Description                  : Get TS URL
'Arguments                    : 
'Return Value                 : NA
'Author                       : Xiaoji.Sun
'Creation Date                : 05 -SEP- 2017
'Special Conditions           : NA                                       
'Revision History             : NA
'Revision Date                : NA
'##################################################################################################################
Function GetTSObjId()
  Set objPage = Sys.Browser("iexplore").Page("*")
  GetTSObjId = objPage.URL
End Function 





'##################################################################################################################
'Function Name                : SearchGCAS
'Description                  : Input the GCAS in top search box and click Go.
'Arguments                    : strNum:GCAS number
'Return Value                 : NA
'Author                       : Sam He
'Creation Date                : 30 -Aug- 2017
'Special Conditions           : NA                                       
'Revision History             : NA
'Revision Date                : NA
'##################################################################################################################
Function SearchGCAS(strSearchNum)
  On Error Resume Next
  'input the value in search box
  arrGetObj = arrGetObjInfoFromXL("CSS_EDITIRMS","SearchBox") 
  Call SetTextByProps(arrGetObj,strSearchNum,c_CSSMainPage_URL)
  Set searchBox = objGetObject(arrGetObj,c_CSSMainPage_URL,30000)
  searchBox.Keys("[Enter]")
  'Select the search item
  arrGetObj = arrGetObjInfoFromXL("CSS_EDITIRMS","SearchForm")   
  Set searchForm = objGetObject(arrGetObj,c_CSSSerrchResult_URL,30000)
  Call searchForm.click(126,145)
  Set searchBox =nothing
  Set searchForm =nothing
End Function 

'##################################################################################################################
'Function Name                : InputValue_Reference
'Description                  : Input the required value in the Reference Tab
'Arguments                    : 
'Return Value                 : NA
'Author                       : Sam He
'Creation Date                : 31 -Aug- 2017
'Special Conditions           : NA                                       
'Revision History             : NA
'Revision Date                : NA
'##################################################################################################################
Function InputValue_Reference()
  arrGetObj = arrGetObjInfoFromXL("CSS_EDITIRMS","ReferenceTab")  
  Call Click(arrGetObj,c_CSSEditPage_URL,30000)
  'Input the search value
  arrGetObj = arrGetObjInfoFromXL("CSS_EDITIRMS","ReferenceStdTable")   
  Set ReferenctTable = objGetObject(arrGetObj,C_CSSReferencePage_URL,30000)
  RowNumber = aqObject.GetPropertyValue(ReferenctTable, "RowCount")'get the table row count
  ReferenctTable.Cell(RowNumber-1,2).Textbox("documentName").SetText "91006006.001"
End Function 



Function Test()
  Dim arrGetObj, objDesc,objSAPDesc,objMater,objReason,objMaterial
      'Get Description 
    arrGetObj = arrGetObjInfoFromXL("CSS_General","GeneralDescription")
    Set objDesc = objGetObject(arrGetObj,c_CSSGeneral_URL,30000)
    objDesc.TextContent="Test"
    
End Function 

'############################################################################################################
'Function Name                : 
'Description                  : 
'Arguments                    : 
'Return Value                 : NA
'Author                       : Lene Yu
'Creation Date                : 26 -Sep- 2017
'Special Conditions           : NA                                       
'Revision History             : NA
'Revision Date                : NA
'############################################################################################################
Function CSS_CopyToCreateNew()
  Set objAction = objGetObject(OR_CSSPDTAtt_ActionBtn,"",30000)
  objAction.Click
  Set objCSS_CopyToCreateNew = objGetObject(OR_CSSPDTAtt_CSS_CopyToCreateNew,"",30000)
  objCSS_CopyToCreateNew.Click
End Function
'############################################################################################################
'Function Name                : 
'Description                  : 
'Arguments                    : 
'Return Value                 : NA
'Author                       : Lene Yu
'Creation Date                : 27 -Sep- 2017
'Special Conditions           : NA                                       
'Revision History             : NA
'Revision Date                : NA
'############################################################################################################
Function CSS_Confirm_OK()
  Set objConfirm_ok = objGetObject(OR_CSSPDTCopy_ConfirmBtn,"",30000)
  objConfirm_ok.Click
 
End Function

'############################################################################################################
'Function Name                : CSS_CreateNew
'Description                  : CreateNew entry to get a create page
'Arguments                    : NA
'Return Value                 : NA
'Author                       : Lene Yu
'Creation Date                : 28 -Sep- 2017
'Special Conditions           : NA                                       
'Revision History             : NA
'Revision Date                : NA
'############################################################################################################
Function CSS_CreateNew()
  'click Originator>>Technical Standards
  Set objOriginator = objGetObject(OR_CSSTopMenu_CSSOriginatorBtn,"",30000)
  objOriginator.Click
  Set objTechnicalStandards = objGetObject(OR_CSSTopMenu_CSSOriginator_TechnicalStandardsBtn,"",30000)
  objTechnicalStandards.Click
  AqUtils.Delay(2000)
  'click Create New Standards
  Set objCreateNewStandards=objGetObject(OR_CSSCreate_CreateNewLnk,"",30000)
  objCreateNewStandards.Click  
End Function

'*************added in 27 ,Sep ,2017 *******************'
'*************Lene Yu*********************'
Function CSS_CopyToCreateProductData(strPDT,strSetName,strGcasCode)
  'get new TSnumber and write into Excel
   strOutputDataFilePath=g_strOutputDataFilePath&strSetName&"_DSM.xlsx"
    strGCASCode = GetGCASCode(strGcasCode)
   Call Excel_InsertValueIntoSpecifiedCell(strOutputDataFilePath, "CSSCreatedData", strPDT, "GCASCODE", strGCASCode)
   'get attribute from excel
   Dim strDesc, strSAPDesc, strReasonForChange,strOrganization,strSegment
   strInputDataFilePath=g_strInputDataFilePath&strSetName&"_DSM.xlsx"
    strDesc =Excel_SearchAttributeInputValue(strInputDataFilePath, "CSSPDT", "Description", strPDT)   
    strSAPDesc = Excel_SearchAttributeInputValue(strInputDataFilePath, "CSSPDT", "SAP Description", strPDT)       
   ' strReasonForChange = Excel_SearchAttributeInputValue(strInputDataFilePath, "CSSPDT", "ReasonForChange", strPDT)
    strOrganization=  Excel_SearchAttributeInputValue(strInputDataFilePath, "CSSPDT", "OwningOrganization", strPDT)
    strSegment = Excel_SearchAttributeInputValue(strInputDataFilePath,"CSSPDT","Segment",strPDT)
   'input SAP Description 
   
   'input Description
   Call CSSCreate_SetDes(strDesc)
   Call CSSCreate_SetSAPDes(strSAPDesc)
   Call CSSCreate_SetOrg(strOrganization)
   Call CSSCreate_SetSeg(strSegment)
   Call CSSCreate_Save() 
End Function 

'*************added in 28 ,Sep ,2017 *******************'
'*************Lene Yu*********************'
Function CSS_CreateProductData(strPDT,strSetName,strGcasCode)
  'get new TSnumber and write into Excel
   strOutputDataFilePath=g_strOutputDataFilePath&strSetName&"_DSM.xlsx"
    strGCASCode = GetGCASCode(strGcasCode)
   Call Excel_InsertValueIntoSpecifiedCell(strOutputDataFilePath, "CSSCreatedData", strPDT, "GCASCODE", strGCASCode)
   'get attribute from excel
   Dim strDesc, strSAPDesc, strReasonForChange,strOrganization,strSegment,strSubType,strDocument
   strInputDataFilePath=g_strInputDataFilePath&strSetName&"_DSM.xlsx"
    strDesc =Excel_SearchAttributeInputValue(strInputDataFilePath, "CSSPDT", "Description", strPDT)   
    strSAPDesc = Excel_SearchAttributeInputValue(strInputDataFilePath, "CSSPDT", "SAP Description", strPDT)       
   ' strReasonForChange = Excel_SearchAttributeInputValue(strInputDataFilePath, "CSSPDT", "ReasonForChange", strPDT)
    strOrganization=  Excel_SearchAttributeInputValue(strInputDataFilePath, "CSSPDT", "OwningOrganization", strPDT)
    strSegment = Excel_SearchAttributeInputValue(strInputDataFilePath,"CSSPDT","Segment",strPDT)
    strSubType = Excel_SearchAttributeInputValue(strInputDataFilePath,"CSSPDT","SubType",strPDT)
    strDocument = Excel_SearchAttributeInputValue(strInputDataFilePath, "CSSPDT", "Technical standards Document", strPDT)
   'input SAP Description  & Description
    Call CSS_FilUpload(ProjectSuite.Path&"Resources\UploadFile\"&strDocument)
   Call CSSCreate_SetDes(strDesc)
   Call CSSCreate_SetSAPDes(strSAPDesc)
   Call CSSCreate_SetOrg(strOrganization)
   Call CSSCreate_SetSeg(strSegment)
   If strSubType <> "" Then
    Call CSSCreate_SelectSubType(strSubType)
   End If
   'Call CSSCreate_Save() 
End Function 

'*************added in 27 ,Sep ,2017 *******************'
'*************Lene Yu*********************'
Function CSSCreate_SetDes(strDesc)
  Set objDes = objGetObject(OR_CSSPDTAtt_GeneralDes,"",30000)
  objDes.TextContent=strDesc
End Function 

Function CSSCreate_SetSAPDes(strSAPDesc)
  Set objSAPDes = objGetObject(OR_CSSPDTAtt_GeneralSAPDes,"",30000)
   objSAPDes.SetText(strSAPDesc) 
End Function 

Function CSSCreate_SetReasonForChange(strReasonForChange)
  Set objReasonForChange=objGetObject(OR_CSSPDTAtt_ReasonForChange,"",30000)
  'need to update
End Function 

Function CSSCreate_SetOrg(strOrganization)

  Set objOrg=objGetObject(OR_CSSPDTAtt_OrgPickBtn,"",30000)
  Set bojOrgTable = objOrg.Parent
  Set objOrgPick = bojOrgTable.FindChild(aPropNames,aPropValues,10)
  objOrgPick.Click
  AqUtils.Delay(4000)
  Set objOrgPicklist=objGetObject(OR_CSSPDTAtt_OrgPicklistSearchPicklist,g_CSSSearchGroup_URL,30000) 
  objOrgPicklist.ClickItem strOrganization
 
  Set objOrgPicklistSave=objGetObject(OR_CSSPDTAtt_PicklistSearchSave,g_CSSSearchGroup_URL,30000)
  objOrgPicklistSave.Click
End Function

Function CSSCreate_SetSeg(strSeg)
  
  Set objSeg=objGetObject(OR_CSSPDTAtt_Seg,"",30000)
  'remove none relative items
  objSeg.SelectItem -1, True
  Set objSegRemove=objGetObject(OR_CSSPDTAtt_SegRemoveBtn,"",30000)
  objSegRemove.Click
  'click picklist to start search strSeg
  Set objSegPicktemp=objGetObject(OR_CSSPDTAtt_SegPickBtn,"",30000)
  Set objSegTable = objSegPicktemp.Parent
  Set objSegPick = objSegTable.FindChild(aPropNames,aPropValues,10)
  objSegPick.Click
  AqUtils.Delay(2000)
  Set objSegSearch=objGetObject(OR_CSSPDTAtt_SegPicklistSearch,"http://*.na.pg.com/CSSFieldSearch.action",30000)
  objSegSearch.Click
   AqUtils.Delay(2000)
  Set objSegPicklist=objGetObject(OR_CSSPDTAtt_SegPicklistSearchPicklist,"http://*.na.pg.com/CSSFieldSearch.action",30000)
  objSegPicklist.ClickItem strSeg
  Set objSegPicklistAdd=objGetObject(OR_CSSPDTAtt_SegPicklistSearchAdd,g_CSSSearchGroup_URL,30000)
  objSegPicklistAdd.Click
  Set objSegPicklistSave = objGetObject(OR_CSSPDTAtt_PicklistSearchSave,g_CSSSearchGroup_URL,30000)
  objSegPicklistSave.Click
End Function

Function CSSCreate_Save()
  Set objAction = objGetObject(OR_CSSPDTAtt_ActionBtn,"",30000)
  objAction.Click
  Set objSave = objGetObject(OR_CSSPDTAtt_Save,"",30000)
  objSave.Click
End Function 

Function CSSCreate_SelectSubType(strSubType)
  Set objAction = objGetObject(OR_CSSPDTAtt_SubTypeLst,"",30000)
  objAction.ClickItem strSubType
End Function 